title: 69.Go反射-忠告
date: 2020-05-22
tags: Go
categories: Go语言
layout: post

------

摘要：本节给使用`Go`语言内置的反射机制的用户提出几点小心使用的忠告...

<!-- more -->

## 忠告一

基于反射的代码是比较脆弱的

- 会因为类型错误，在运行时抛出`panic`异常
  - 需要小心的检查每个`Value`对应值的类型、是否可取地址，是否可被修改
  - 将所有反射相关的使用控制在包内部，避免包的`API`中直接暴露`Value`类型，可以限制一些非法输入
- 降低了程序的安全性
- 影响自动化重构和分析工具的准确性，无法识别运行时才能确认的类型信息

## 忠告二

基于反射的代码不易维护

- 反射操作不能做静态类型检查
- 反射代码通常难以理解
- 需要小心翼翼地为每个导出的类型和其它接受`interface{}`或`reflect.Value`类型参数的函数维护说明文档

## 忠告三

基于反射的代码运行速度慢

- 运行速度慢`1-2`个数量级
- 对性能要求严苛的场景（如：设备通信等）或性能关键路径的函数，应避免使用反射
- 对大型交互类程序（函数性能不会影响整体性能）或测试，适合使用反射，提高开发效率和清晰度