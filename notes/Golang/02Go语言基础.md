title: 02.Go语言学习笔记-Go语言基础
date: 2020-04-02
tags: Go
categories: Go语言
layout: post

------

摘要：Go语言有其独特的程序结构和要素，在开始正式学习前，需要了解这些不同点，以免与其它语言语法产生混淆。本节内容包括：命名规则、注释、程序结构、包和文件...

<!-- more -->

## 命名规则

`go`语言有其独有的命名规则，包括：文件名、关键字、标识符等

### 文件名

- `go`的源文件以`.go`为后缀名
- 文件名应全部小写，如：`hello.go`
- 复杂文件名使用下划线`_`分割，如：`scanner_test.do`

### 关键字

为简化在编译过程第一步中的代码解析，`go`大幅减少了关键字的数量，只保留25个关键字

|          |             |        |           |        |
| -------- | ----------- | ------ | --------- | ------ |
| break    | default     | func   | interface | select |
| case     | defer       | go     | map       | struct |
| chan     | else        | goto   | package   | switch |
| const    | fallthrough | if     | range     | type   |
| continue | for         | import | return    | var    |

### 标识符

- 以字母、`_`开头
- 后面只能包含字母和数字
- 使用**驼峰式**命名（如：`myName`）
- 全局作用域标识符，首字母大写（如：`MyName`）
- 缩略词避免大小写混合，如：`HTML`、`ASCII`等，不应写成`Ascii`、`Html`等
- 大小写敏感，如：`myName`和`MyName`是不同的

## 注释

### 语法

可以使用`//`和`/* */`两种方式，不支持嵌套使用

- `//`一行
- `/* */`多行

### 规范

- 在程序文件`.go`开头，添加包级注释
- 变量、常量、函数、结构等声明语句前添加注释
- 注释内容的写法：被注释标识符名称 + `空格` + 注释内容

### 文档

使用`godoc`指令（需要安装），可以将程序文件中的注释汇总输出到`HTML`页面中。

注：具体使用见`105Go命令doc`章节

## 作用域

声明语句将程序中的实体和一个名字关联。声明语句的作用域是指源代码中可以有效使用这个名字的范围

作用域与生命周期是不同的概念，不要混为一谈

- 作用域：编译时属性，源代码中有效使用这个名字的范围
- 生命周期：运行时属性，运行时变量存在的有效时间

**句法块/词法块**

句法块：是由花括弧所包含的一系列语句，就像函数体或循环体花括弧包裹的内容一样。

词法块：将句法块扩展到不含花括弧的其他声明，如：全局、包、`if`、`for`、`switch`、`select`等语句

不管是句法块还是词法块，声明语句对应的词法域决定了作用域范围的大小

- 内置的类型、函数和常量，**全局作用域**，整个应用都可以访问
- 函数外部声明的标识符，**包级作用域**，包中任何文件都可访问
- 导入的包，**文件级作用域**，当前文件内可以访问
- 函数内声明的标识符，**局部作用域**，函数内可以访问

**同名不用域**

允许在不同的词法域中声明同名标识符，但会导致可读性变差

```go
package hello

var a int = 0

func F1() {
  a := "10"
  {
    var a = false
  }
}
```

当存在多个同名标识符时，编译器从最内层词法域向全局作用域查找，如果没有找到则报告“未声明的名字”这样的错误。也就是说，内部声明会屏蔽外部同名的声明，导致外部声明无法被访问

由于很多隐晦的作用域的存在，会导致代码并不像我们预期的那样使用标识符

下例中，使用短声明的标识符`f`，其作用域在`if`词法块中，因此，`if`语句后面继续访问`f`是不允许的

```go
if f, err := os.Open(fname); err != nil { // compile error: unused: f
    return err
}
f.ReadByte() // compile error: undefined f
f.Close()    // compile error: undefined f
```

下例中，函数内的短声明`cwd`将创建一个新的同名标识符，而不是使用函数外部的`cwd`，如果没有最后的输出语句，在编译时会提示`cwd`没有被使用，我们就会发现问题。但因为该输出语句屏蔽了错误提示，导致我们很难发现问题

```go
var cwd string

func init() {
    cwd, err := os.Getwd() // NOTE: wrong!
    if err != nil {
        log.Fatalf("os.Getwd failed: %v", err)
    }
    log.Printf("Working directory = %s", cwd) //输出cwd
}
```



## 程序结构

### 目录结构

`go`有两个需要注意的环境变量

- `GOROOT`，表示`go`安装目录。编译器、开源代码、标准库、工具等
- `GOPATH`，表示`go`工作目录。三方库、三方工具、工作代码

可以使用`go env`查看并修改配置信息

```bash
set GOPATH=D:\Users\lijie\go;
set GOROOT=c:\go
```

### 工作目录

> 即`GOPATH`环境变量对应的目录

工作目录中，创建三个子目录

- `src`源代码，存放工作源代码文件（使用`go mod`模式，则不使用该目录）
- `pkg`第三方模块，存放第三方开源模块的文件（使用`go mod`模式，则放在该目录下的`mod`子目录中）
- `bin`第三方工具，如代码提示、自动补齐、代码检查等，以及`go install`安装的项目可执行文件

配置工作目录，是为了在`import`模块、加载工具时，避免输入过长的目录名称，`go`将自动从工作目录中查找相关信息

### 文件

`go`代码保存在`.go`后缀的文件中，是`Go`体系中最小的元素

```go
/*
定义xxx的model
*/
package model // 1. 第一行非注释代码必须是包定义

import (			// 2. 后面是需要引入的包，按照字母排序	
	"fmt"
)

// 3. 定义长江、变量、类型等
// 3.1 变量首字母小写，只能在包内使用；首字母大写，可以在其它包中使用，类似于export的功能
// 3.2 函数也是一样的，默认是camel命名，首字母大写的函数名可以在其它包中使用
const (
	a = iota 
	b
	c
  E
  F
)

// 4. 自定义函数
// 4.1 可以定义init()函数，将在main()函数前执行
func hello() {
  ...
}

// 5. 程序入口，需要定义main()函数
func main() {
	fmt.Println("hello:", a, b, c)
}
```

`Go`语言的源文件按照功能可以划分为三类：

- 命令源文件

  包含`main()`函数的文件，总是作为可执行程序的入口。一个可执行程序只有一个命令源文件

- 库源文件

  实现业务功能所需的各种程序实体，如：全局常量、全局变量、接口、结构体、函数等等。我们编写的绝大多数源文件都属于**库源文件**

- 测试源文件

  对另外两种源文件中的程序实体进行功能和性能测试。一般情况下，测试源文件的文件名中包含`test`字符

